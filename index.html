<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Shorttrack DataTool</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@400;500;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="styles.css" />
  <script defer src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script defer src="app.js"></script>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo" aria-hidden="true">ST</div>
      <div class="brandText">
        <div class="brandTitle">Shorttrack DataTool</div>
        <div class="brandSub">Upload → Analyse → Vergelijk</div>
      </div>
    </div>

    <div class="topActions">
      <button class="btn btnGhost" id="btnOpenMapping" type="button" title="Kolommen & mapping">
        Mapping
      </button>
      <label class="btn btnPrimary" for="fileInput" title="Upload Excel">
        Upload Excel
      </label>
      <input id="fileInput" class="srOnly" type="file" accept=".xlsx,.xls" />
    </div>
  </header>

  <div class="app">
    <aside class="sidebar">
      <nav class="nav">
        <button class="navItem active" data-view="dashboard" type="button">Dashboard</button>
        <button class="navItem" data-view="query" type="button">Filters & Parameters</button>
        <button class="navItem" data-view="h2h" type="button">Head-to-Head</button>
        <button class="navItem" data-view="champions" type="button">Kampioenen</button>
      </nav>

      <div class="statusCard" id="statusCard">
        <div class="statusTitle">Dataset</div>
        <div class="statusRow"><span>Bestand</span><span id="statusFile">—</span></div>
        <div class="statusRow"><span>Rijen</span><span id="statusRows">—</span></div>
        <div class="statusRow"><span>Kolommen</span><span id="statusCols">—</span></div>
        <div class="statusHint" id="statusHint">
          Upload een Excel-bestand (.xlsx) om te starten.
        </div>
      </div>

      <div class="helpCard">
        <div class="helpTitle">Snelstart</div>
        <ol class="helpList">
          <li>Upload je Excel</li>
          <li>Check/zet de mapping (knop <b>Mapping</b>)</li>
          <li>Selecteer een module links</li>
        </ol>
      </div>
    </aside>

    <main class="content">
      <!-- DASHBOARD -->
      <section class="view" id="view-dashboard">
        <div class="viewHeader">
          <h1>Dashboard</h1>
          <div class="controls">
            <div class="control">
              <label for="dashRider">Rijder</label>
              <select id="dashRider" disabled></select>
            </div>
          </div>
        </div>

        <div class="tiles" id="dashTiles">
          <div class="tile"><div class="tileLabel">Starts</div><div class="tileValue" data-tile="starts">—</div></div>
          <div class="tile"><div class="tileLabel">Overwinningen</div><div class="tileValue" data-tile="wins">—</div></div>
          <div class="tile"><div class="tileLabel">Podiums</div><div class="tileValue" data-tile="podiums">—</div></div>
          <div class="tile"><div class="tileLabel">Beste tijd</div><div class="tileValue" data-tile="bestTime">—</div></div>
          <div class="tile"><div class="tileLabel">Gem. tijd</div><div class="tileValue" data-tile="avgTime">—</div></div>
          <div class="tile"><div class="tileLabel">Beste rank</div><div class="tileValue" data-tile="bestRank">—</div></div>
          <div class="tile"><div class="tileLabel">Laatste start</div><div class="tileValue" data-tile="lastDate">—</div></div>
          <div class="tile"><div class="tileLabel">Meest gereden afstand</div><div class="tileValue" data-tile="topDistance">—</div></div>
        </div>

        <div class="card">
          <div class="cardHeader">
            <h2>Snelle details</h2>
            <div class="cardSub">Automatisch op basis van je kolommen (mapping aanpasbaar).</div>
          </div>
          <div class="cardBody" id="dashDetails">
            <div class="empty">Upload een dataset om details te zien.</div>
          </div>
        </div>
      </section>

      <!-- QUERY BUILDER -->
      <section class="view hidden" id="view-query">
        <div class="viewHeader">
          <h1>Filters & Parameters</h1>
          <div class="controls">
            <button class="btn btnGhost" id="btnAddRule" type="button" disabled>+ Filter</button>
            <button class="btn btnPrimary" id="btnRunQuery" type="button" disabled>Toon resultaten</button>
          </div>
        </div>

        <div class="card">
          <div class="cardHeader">
            <h2>Filterregels</h2>
            <div class="cardSub">Combineer regels met AND/OR (eerste versie: alles AND, OR per regel).</div>
          </div>
          <div class="cardBody">
            <div id="rules"></div>
            <div class="muted" style="margin-top:10px">Tip: Gebruik <b>Kolom</b> → <b>Operator</b> → <b>Waarde</b>. Voor numerieke kolommen werkt &lt;, &gt;, tussen.</div>
          </div>
        </div>

        <div class="card">
          <div class="cardHeader">
            <h2>Resultaten</h2>
            <div class="cardSub"><span id="queryCount">0</span> rijen</div>
          </div>
          <div class="cardBody">
            <div class="tableWrap">
              <table class="table" id="queryTable"></table>
            </div>
          </div>
        </div>
      </section>

      <!-- HEAD TO HEAD -->
      <section class="view hidden" id="view-h2h">
        <div class="viewHeader">
          <h1>Head-to-Head</h1>
          <div class="controls">
            <div class="control">
              <label for="h2hCount">Aantal rijders</label>
              <select id="h2hCount" disabled>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
              </select>
            </div>
            <button class="btn btnPrimary" id="btnBuildH2H" type="button" disabled>Vergelijk</button>
          </div>
        </div>

        <div class="card">
          <div class="cardHeader">
            <h2>Selecteer rijders</h2>
            <div class="cardSub">Geen scheiding M/V nodig, maar je kunt eventueel filteren op gender-kolom in de mapping.</div>
          </div>
          <div class="cardBody">
            <div id="h2hSelectors" class="h2hSelectors"></div>
          </div>
        </div>

        <div class="card">
          <div class="cardHeader">
            <h2>In één oogopslag</h2>
            <div class="cardSub">Kernstats per rijder, plus verschil-indicators.</div>
          </div>
          <div class="cardBody" id="h2hSummary">
            <div class="empty">Upload een dataset om te starten.</div>
          </div>
        </div>

        <div class="card">
          <div class="cardHeader">
            <h2>Vergelijkingstabel</h2>
            <div class="cardSub">Kies zelf welke metrics je wilt zien.</div>
          </div>
          <div class="cardBody">
            <div class="controls" style="justify-content:flex-start; gap:12px; margin-bottom:10px">
              <div class="control" style="min-width:260px">
                <label for="h2hMetric">Metric (kolom)</label>
                <select id="h2hMetric" disabled></select>
              </div>
              <div class="control" style="min-width:220px">
                <label for="h2hAgg">Aggregatie</label>
                <select id="h2hAgg" disabled>
                  <option value="best">Beste (min)</option>
                  <option value="avg">Gemiddelde</option>
                  <option value="max">Max</option>
                  <option value="count">Aantal (non-empty)</option>
                </select>
              </div>
              <button class="btn btnGhost" id="btnAddMetricRow" type="button" disabled>+ Voeg rij toe</button>
              <button class="btn btnPrimary" id="btnRenderH2HTable" type="button" disabled>Update tabel</button>
            </div>

            <div class="tableWrap">
              <table class="table" id="h2hTable"></table>
            </div>
          </div>
        </div>
      </section>

      <!-- CHAMPIONS -->
      <section class="view hidden" id="view-champions">
        <div class="viewHeader">
          <h1>Wereld- & Olympisch kampioenen</h1>
          <div class="controls">
            <button class="btn btnPrimary" id="btnBuildChamps" type="button" disabled>Genereer lijst</button>
          </div>
        </div>

        <div class="card">
          <div class="cardHeader">
            <h2>Instelling</h2>
            <div class="cardSub">Deze module heeft specifieke kolommen nodig. Selecteer ze hieronder (mapping kan ook).</div>
          </div>
          <div class="cardBody">
            <div class="grid2">
              <div class="control">
                <label for="chTypeCol">Titeltype-kolom</label>
                <select id="chTypeCol" disabled></select>
                <div class="hint">Bijv. “Title”, “Championship”, “Medal”, “ResultType”.</div>
              </div>
              <div class="control">
                <label for="chYearCol">Jaarkolom</label>
                <select id="chYearCol" disabled></select>
                <div class="hint">Bijv. “Year”, “Season”, “Datum”.</div>
              </div>
            </div>
            <div class="grid2" style="margin-top:10px">
              <div class="control">
                <label for="chWorldValue">Waarde voor Wereldkampioen</label>
                <input id="chWorldValue" type="text" placeholder="bijv. World Champion" disabled />
              </div>
              <div class="control">
                <label for="chOlympicValue">Waarde voor Olympisch kampioen</label>
                <input id="chOlympicValue" type="text" placeholder="bijv. Olympic Champion" disabled />
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="cardHeader">
            <h2>Resultaat</h2>
            <div class="cardSub">Groepeert per jaar, met unieke rijders.</div>
          </div>
          <div class="cardBody" id="champsResult">
            <div class="empty">Upload een dataset om te starten.</div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Mapping modal -->
  <div class="modal hidden" id="mappingModal" role="dialog" aria-modal="true" aria-labelledby="mappingTitle">
    <div class="modalBackdrop" data-close="true"></div>
    <div class="modalPanel">
      <div class="modalHeader">
        <div>
          <div class="modalTitle" id="mappingTitle">Kolommen & Mapping</div>
          <div class="modalSub">Koppel jouw kolomnamen aan de velden die de tool gebruikt.</div>
        </div>
        <button class="iconBtn" id="btnCloseMapping" type="button" aria-label="Sluiten">✕</button>
      </div>

      <div class="modalBody">
        <div class="grid2">
          <div class="control">
            <label for="mapRider">Rijderkolom</label>
            <select id="mapRider"></select>
          </div>
          <div class="control">
            <label for="mapGender">Genderkolom (optioneel)</label>
            <select id="mapGender"></select>
          </div>
        </div>

        <div class="grid2" style="margin-top:10px">
          <div class="control">
            <label for="mapCountry">Land/NOC kolom (optioneel)</label>
            <select id="mapCountry"></select>
          </div>
          <div class="control">
            <label for="mapDistance">Afstand/Discipline kolom (optioneel)</label>
            <select id="mapDistance"></select>
          </div>
        </div>

        <div class="grid2" style="margin-top:10px">
          <div class="control">
            <label for="mapTime">Tijd kolom (optioneel)</label>
            <select id="mapTime"></select>
          </div>
          <div class="control">
            <label for="mapRank">Rank/Positie kolom (optioneel)</label>
            <select id="mapRank"></select>
          </div>
        </div>

        <div class="grid2" style="margin-top:10px">
          <div class="control">
            <label for="mapDate">Datum kolom (optioneel)</label>
            <select id="mapDate"></select>
          </div>
          <div class="control">
            <label for="mapCompetition">Wedstrijd/Event kolom (optioneel)</label>
            <select id="mapCompetition"></select>
          </div>
        </div>

        <div class="muted" style="margin-top:12px">
          Als je kolomnamen afwijken, kun je hier alles koppelen. Zonder mapping werkt de tool ook: je kunt dan nog steeds filteren en een simpele head-to-head maken.
        </div>
      </div>

      <div class="modalFooter">
        <button class="btn btnGhost" id="btnResetMapping" type="button">Reset (auto)</button>
        <button class="btn btnPrimary" id="btnSaveMapping" type="button">Opslaan</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast" aria-live="polite" aria-atomic="true"></div>
</body>
</html>
